<!DOCTYPE html>
<html>
  <head>
    <title>Choropleth</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
		width: 50%;
		background-color: grey;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      var map;
	  
	  
		
      function initMap() {
	  var Melbourne = {lat: -37.796473, lng: 144.977661};
        map = new google.maps.Map(document.getElementById('map'), {
          center: Melbourne,
          zoom: 12
        });


		
		  //  Loading data
		var suburbLayer = new google.maps.Data();
		suburbLayer.loadGeoJson('./suburbOutputWithTweets.json');
		//suburbLayer.loadGeoJson('http://data.gov.au/geoserver/vic-suburb-locality-boundaries-psma-administrative-boundaries/wfs?request=GetFeature&typeName=af33dd8c_0534_4e18_9245_fc64440f742e&outputFormat=json');
		
		  // Set a blank infoWindow to be used for each to state on click
		var infoWindow = new google.maps.InfoWindow({
			content: ""
		});
		
		  // Set and apply styling to the Suburb Layer
		suburbLayer.setStyle(function(feature) {
			return {
			//try
				fillColor: getColor(feature.getProperty('numTweets')), // call function to get color for state based on the ...
			//catch
			//	fillColor: '#b3b3b3',
			fillOpacity: 0.8,
			strokeColor: '#b3b3b3',
			strokeWeight: 1,
			zIndex: 1
			};
		  });
		  // returns a color based on the value given when the function is called
		  function getColor(property) {
			var colors = [
			  '#d1ccad',
			  '#c2c083',
			  '#cbd97c',
			  '#acd033',
			  '#89a844'
			];
			 return property >= 11 ? colors[4] :
			property > 7 ? colors[3] :
			property > 3 ? colors[2] :
			property > 0 ? colors[1] :
			colors[0];
			}
		  
		// Add mouseover and mouse out styling for the GeoJSON State data
		suburbLayer.addListener('mouseover', function(e) {
			suburbLayer.overrideStyle(e.feature, {
			strokeColor: '#2a2a2a',
			strokeWeight: 2,
			zIndex: 2
			});
		});
		
		suburbLayer.addListener('mouseout', function(e) {
			suburbLayer.revertStyle();
		});
		
		// Adds an info window on click with in a state that includes the state name and COLI
		setTimeout(function() {
			suburbLayer.addListener('click', function(e) {
				console.log(e);
				infoWindow.setContent('<div style="line-height:1.00;overflow:hidden;white-space:nowrap;">' +
				e.feature.getProperty('name') + '<br> Number of Tweets: ' +
				e.feature.getProperty('numTweets') + '</div>');

			var anchor = new google.maps.MVCObject();
			anchor.set("position", e.latLng);
			infoWindow.open(map, anchor);
			});
		}, 1000);

		// Final step here sets the Suburb Layer GeoJSON data onto the map
		suburbLayer.setMap(map);
		
      }

	  function customizeLayer(layer) {
	  //put stuff here
	  }
	  
    </script>
	</script>
    <script src="./markerclusterer.js">
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBrXsh6sZYoCurN67TR0015R93biestUis&callback=initMap"
    async defer></script>
  </body>
</html>